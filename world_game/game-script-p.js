window.requestAFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},window.onload=window.onresize=function(){WIDTH=window.innerWidth,HEIGHT=window.innerHeight,(canvas=document.getElementById("canvas")).width=WIDTH,canvas.height=HEIGHT,init()};var canvas,ctx,keystate,player,WIDTH=800,HEIGHT=500,ontouch_1=0;function main(){canvas=document.getElementById("canvas"),document.getElementById("loading").style.visibility="hidden",canvas.width=WIDTH,canvas.height=HEIGHT,ctx=canvas.getContext("2d"),(tapToStart_btn=document.getElementById("btn1")).style.visibility="visible",canvas.addEventListener("touchstart",function(t){var a=WIDTH/3,t=t.touches[0].pageX;ontouch_1=0!=game_state&&2!=game_state?t<a?1:2*a<t?3:2:4}),canvas.addEventListener("touchend",function(t){ontouch_1=0}),keystate={},document.addEventListener("keydown",function(t){keystate[t.keyCode]=!0}),document.addEventListener("keyup",function(t){keystate[t.keyCode]=!1});Math.random(1);init(),game_loop()}var tapToStart_btn,bricks=[],brickCount=1230,clouds=[],cloudCount=130,mounts=[],mountsCount=160,mounts_f=[],mountsCount_f=230,coins=[],coinsCount=30,stars=[],starsCount=70,scale=.6;function init(){coins=[],stars=[],mounts_f=[],mounts=[],clouds=[],bricks=[];for(var t=300,a=150,e=0;e<starsCount;e++){var s=400-450*Math.random(1),r=200-330*Math.random(1),l=2*Math.random(1);stars.push({id:e,x:t,y:a,width:3+l,height:3+l,radius:1,hsl_l:s}),t=200+s,a=r}for(var c=0,i=HEIGHT/2+200,e=0;e<mountsCount;e++){s=10*Math.random(1);mounts.push({id:e,x:c+10*s,y:i,width:400*s*.2*scale,height:200*s*.2*scale,hsl_l:s}),c+=330,10==e&&(i=HEIGHT/2+200+30,c=0),20==e&&(i=HEIGHT/2+200+50,c=0),23!=e&&16!=e&&4!=e||(i=HEIGHT/2+200+60,c=0)}for(var o=0,n=HEIGHT+70,x=0;x<mountsCount_f;x++){s=30*Math.random(1);mounts_f.push({id:x,x:o,y:n-(10+s),width:400*s*.06*scale,height:150*s*.06*scale,hsl_l:.3*s}),o+=60*scale+6*s}for(var d=0,y=HEIGHT/2+100,x=0;x<cloudCount;x++){s=100*Math.random(1);clouds.push({id:x,x:d,y:y-(10+s),width:100*scale,height:250*scale,velX:0,velY:0,radius:10+s}),d+=10*scale+ +s}for(var h=0,u=HEIGHT/2+100,x=0;x<coinsCount;x++){s=100*Math.random(1);coins.push({id:x,x:h,y:u,width:14*scale,height:14*scale,state:1}),h+=300*scale}for(var p=0,m=HEIGHT/2+100,f=0,e=0;e<brickCount;e++)5==++f&&(f=0),(s=100*Math.random(1))<7&&(s=7),bricks.push({id:e,x:p,y:m+2*s,width:300*scale*s*.2,height:550*scale,velX:0,velY:0,moveY:40+2*s,state:f,radius:14}),p+=300*scale+s;(player={x:null,y:null,width:35*scale,height:50*scale,speed:.3,velX:0,velY:0,jumping:!1,grounded:!1}).x=100*scale,player.y=250*scale,player.grounded=!0}var uparrow=38,downarrow=40,leftarrow=37,rightarrow=39,spacebar=32,gravity=.3,cameraC=0,startXC=0,cameraXC=0,camera_1=0,hsl_h=36,hsl_s=40,hsl_l=21,hsl_l1=21,count=0,sunY=150,sunB=0,sunC=0,count1=0,score=0,c_1=0,game_state=0;function tapToStart(){tapToStart_btn.style.visibility="hidden",game_state=1}var scale_r=1,level_player=1;function game_loop(){ctx.save(),ctx.fillStyle="rgba(130, 130, 130, 1)",ctx.fillRect(0,0,WIDTH,HEIGHT);var t=ctx.createLinearGradient(0,0,0,HEIGHT);t.addColorStop(0,"hsl("+(hsl_h-180)+"deg "+hsl_s+"20% "+(hsl_l-.1*sunB+45)+"%)"),t.addColorStop(1,"hsl("+hsl_h+"deg "+(hsl_s+20+sunB)+"% "+(hsl_l+.2*sunB+45)+"%)"),ctx.fillStyle=t,ctx.fillRect(0,0,WIDTH,HEIGHT),1==game_state&&(ctx.font="700 23px Raleway",ctx.fillStyle="#FFFFFF66",ctx.fillText("S C O R E",WIDTH-144,100),a=t=0,a=9<score?(t=parseInt(score/10),score-10*t):score,a="0 "+t+" "+a,ctx.font="700 45px Raleway",ctx.fillStyle="#FFFFFF",ctx.fillText(a,WIDTH-146,136)),0==player.grounded&&1==game_state&&1-scale_r<0&&(scale_r-=6e-4,ctx.scale(.01*(1-scale_r)+scale_r,.01*(1-scale_r)+scale_r)),1==player.grounded&&1==game_state&&(0<1.02-scale_r?(scale_r+=3e-4,ctx.scale(.01*(1.02-scale_r)+scale_r,.01*(1.02-scale_r)+scale_r)):ctx.scale(1.02,1.02));var a=ctx.createRadialGradient(500,sunY,30,500,sunY,32);a.addColorStop(0,"#FFFFFFFF"),a.addColorStop(1,"#FFFFFF00"),ctx.beginPath(),ctx.arc(500,sunY,250,0,2*Math.PI),ctx.fillStyle=a,ctx.fill();a=ctx.createRadialGradient(500,sunY,30,500,sunY,150);a.addColorStop(0,"#FFFFFF77"),a.addColorStop(1,"#FFFFFF00"),ctx.beginPath(),ctx.arc(500,sunY,250,0,2*Math.PI),ctx.fillStyle=a,ctx.fill(),0==sunC&&sunY<300?(sunB+=.03,sunY+=.05,hsl_l-=.005):300<=sunY&&(sunC=1),1==sunC&&150<sunY?(sunY-=.05,hsl_l+=.005):sunY<=150&&(sunC=0);for(var e=0;e<cloudCount;e++)ctx.beginPath(),ctx.arc(clouds[e].x+clouds[e].velX,clouds[e].y,clouds[e].radius,0,2*Math.PI),clouds[e].velX-=.4,ctx.fillStyle="hsl(0deg 100% 100% / "+hsl_l+"%)",ctx.fill();ctx.rotate(45*Math.PI/180);for(e=0;e<starsCount;e++)ctx.beginPath(),ctx.moveTo(stars[e].x,stars[e].y),ctx.lineTo(stars[e].x+stars[e].width-stars[e].radius,stars[e].y),ctx.arcTo(stars[e].x+stars[e].width,stars[e].y,stars[e].x+stars[e].width,stars[e].y+stars[e].radius,stars[e].radius),ctx.lineTo(stars[e].x+stars[e].width,stars[e].y+stars[e].height-stars[e].radius),ctx.arcTo(stars[e].x+stars[e].width,stars[e].y+stars[e].height,stars[e].x+stars[e].width-stars[e].radius,stars[e].y+stars[e].height,stars[e].radius),ctx.lineTo(stars[e].x+stars[e].radius,stars[e].y+stars[e].height),ctx.arcTo(stars[e].x,stars[e].y+stars[e].height,stars[e].x,stars[e].y+stars[e].height-stars[e].radius,stars[e].radius),ctx.lineTo(stars[e].x,stars[e].y+stars[e].radius),ctx.arcTo(stars[e].x,stars[e].y,stars[e].x+stars[e].radius,stars[e].y,stars[e].radius),ctx.fillStyle="hsl(0deg 0% 100% / "+(13<e?90:50)+"%)",ctx.fill();ctx.rotate(-45*Math.PI/180);for(var s=0;s<coinsCount;s++)1==coins[s].state&&(ctx.fillStyle="hsl("+(hsl_h+120)+"deg "+(hsl_s-50)+"% "+(hsl_l+15)+"%)",ctx.fillRect(coins[s].x-startXC,coins[s].y,coins[s].width,coins[s].height),player.x+player.width>coins[s].x-startXC&&player.x<coins[s].x-startXC+coins[s].width&&player.y+player.height>coins[s].y&&player.y<coins[s].y+coins[s].height&&(coins[s].state=0,score+=1));for(var r=0;r<mountsCount;r++)ctx.beginPath(),ctx.moveTo(mounts[r].x-.2*startXC,mounts[r].y),ctx.lineTo(mounts[r].x-.2*startXC+mounts[r].width/2,mounts[r].y-mounts[r].height),ctx.lineTo(mounts[r].x-.2*startXC+mounts[r].width,mounts[r].y),ctx.lineTo(mounts[r].x+-.2*startXC,mounts[r].y),ctx.fillStyle="hsl("+hsl_h+"deg 5% "+(hsl_l+mounts[r].hsl_l+25)+"%)",ctx.fill();a=HEIGHT+350;ctx.fillStyle="hsl(120deg 53% 32%)",ctx.fillRect(0,a,WIDTH,10),1==game_state&&player.y>a&&(player.velY=0,player.velX=0,game_state=2),level_player=startXC/1e3,player.width=level_player,player.height=level_player,ctx.fillStyle="#edfbff",ctx.font="700 10px Raleway",ctx.fillText("L e v e l  "+level_player,player.x+30,player.y-10),ctx.fillStyle="hsl("+hsl_h+"deg "+hsl_s+"% "+(hsl_l+15)+"%)",ctx.fillRect(player.x,player.y,player.width,player.height),ctx.beginPath(),ctx.moveTo(player.x+23*scale,player.y+10*scale),ctx.lineTo(player.x+28*scale,player.y+15*scale),ctx.lineTo(player.x+23*scale,player.y+20*scale),ctx.lineTo(player.x+18*scale,player.y+15*scale),ctx.fillStyle="#FFF",ctx.fill(),!keystate[spacebar]&&4!=ontouch_1||(2==game_state&&(startXC=0,player.x=120,player.y=200),tapToStart()),1==game_state&&(keystate[leftarrow]||1==ontouch_1?(player.velX-=player.speed,c_1=1):keystate[rightarrow]||3==ontouch_1?(player.velX+=player.speed,c_1=1):(player.velX=0,1==c_1&&(c_1=2,camera_1=cameraXC=startXC)),5<player.velX&&(player.velX=5),player.velX<-5&&(player.velX=-5),(keystate[uparrow]||2==ontouch_1)&&player.grounded&&(player.grounded=!1,player.velY=-8),10<player.velY&&(player.velY=10),player.velY<-10&&(player.velY=-10)),2!=game_state&&(player.velY+=gravity),0==cameraC&&player.x<WIDTH/2?player.x+=player.velX:0==cameraC&&player.x>=WIDTH/2&&(cameraC=1),1==cameraC&&(1==c_1?startXC+=player.velX:2==c_1&&(startXC<camera_1+40?cameraXC+=3:camera_1+40<=startXC&&(c_1=0),startXC=.05*(camera_1+40-cameraXC)+cameraXC)),1==cameraC&&startXC<=0&&(cameraC=0),count++,ctx.font="16px Raleway";for(var l=0;l<brickCount;l++){ctx.fillStyle="hsl("+(hsl_h+180)+"deg "+(hsl_s-30)+"% "+(hsl_l+15)+"%)";bricks[l].velY;1==bricks[l].state&&bricks[l].velY<bricks[l].moveY?bricks[l].velY+=1:1==bricks[l].state&&bricks[l].velY>=bricks[l].moveY&&(bricks[l].state=2),2==bricks[l].state&&0<bricks[l].velY?--bricks[l].velY:2==bricks[l].state&&bricks[l].velY<=0&&(bricks[l].state=1);var c=bricks[l].y+bricks[l].velY,i=bricks[l].y+bricks[l].velY+bricks[l].height;ctx.beginPath(),ctx.moveTo(bricks[l].x-startXC,c),ctx.lineTo(bricks[l].x+bricks[l].width-startXC-bricks[l].radius,c),ctx.arcTo(bricks[l].x+bricks[l].width-startXC,c,bricks[l].x+bricks[l].width-startXC,c+bricks[l].radius,bricks[l].radius),ctx.lineTo(bricks[l].x+bricks[l].width-startXC,i-bricks[l].radius),ctx.arcTo(bricks[l].x+bricks[l].width-startXC,i,bricks[l].x+bricks[l].width-bricks[l].radius-startXC,i,bricks[l].radius),ctx.lineTo(bricks[l].x+bricks[l].radius-startXC,i),ctx.arcTo(bricks[l].x-startXC,i,bricks[l].x-startXC,i-bricks[l].radius,bricks[l].radius),ctx.lineTo(bricks[l].x-startXC,c+bricks[l].radius),ctx.arcTo(bricks[l].x-startXC,c,bricks[l].x+bricks[l].radius-startXC,c,bricks[l].radius),ctx.fill(),player.y+player.velY+player.height>c&&player.x+player.width>bricks[l].x-startXC&&player.x<bricks[l].x-startXC+bricks[l].width&&(player.velY=player.velY-(player.y+player.velY+player.height-c),player.grounded=!0),player.x+player.width>bricks[l].x-startXC&&player.x>bricks[l].x-30&&player.x<bricks[l].x&&player.y+player.height>c+10&&player.y<c+bricks[l].height-4&&(player.velX=0)}player.y+=player.velY;a=ctx.createLinearGradient(0,HEIGHT-100,0,HEIGHT+60);a.addColorStop(1,"#FFFFFFCC"),a.addColorStop(0,"#FFFFFF00"),ctx.fillStyle=a,ctx.fillRect(0,HEIGHT-100,WIDTH,100);for(r=0;r<mountsCount_f;r++)ctx.beginPath(),ctx.moveTo(mounts_f[r].x-1.1*startXC,mounts_f[r].y),ctx.lineTo(mounts_f[r].x-1.1*startXC+mounts_f[r].width/2,mounts_f[r].y-mounts_f[r].height),ctx.lineTo(mounts_f[r].x-1.1*startXC+mounts_f[r].width,mounts_f[r].y),ctx.lineTo(mounts_f[r].x-1.1*startXC,mounts_f[r].y),ctx.fillStyle="hsl("+hsl_h+"deg 5% "+(hsl_l+5)+"%)",ctx.fill();0==game_state&&(ctx.fillStyle="#FFF",ctx.font="700 50px Raleway",ctx.fillText("W O R L D",WIDTH/2-110,100),ctx.font="700 27px Raleway",ctx.fillText("H A L L O W E E N",WIDTH/2-106,124)),1==game_state&&startXC<50&&(ctx.fillStyle="#FFF",ctx.font="700 16px Raleway",/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(ctx.fillRect(WIDTH/3,100,3,HEIGHT-200),ctx.fillText("Go Back",WIDTH/3-210,HEIGHT/2),ctx.fillText("Jump",WIDTH/3+140,HEIGHT/2),ctx.fillRect(WIDTH/3*2,100,3,HEIGHT-200),ctx.fillText("Go Forward",WIDTH/3*2+110,HEIGHT/2)):ctx.fillText("- U s e  a r r o w k e y s  t o  m o v e  p l a y e r",WIDTH/2+0,HEIGHT/2)),2==game_state&&(ctx.fillStyle="#edfbff",ctx.font="700 60px Raleway",ctx.fillText("G A M E",WIDTH/2-110,HEIGHT-150+120),ctx.font="700 63px Raleway",ctx.fillText("O V E R",WIDTH/2-110,HEIGHT-100+120)),ctx.restore(),ctx.fillStyle="#FFFFFF",ctx.font="20px Raleway",setTimeout(function(){requestAFrame(game_loop)},0)}window.addEventListener("load",function(){main()});